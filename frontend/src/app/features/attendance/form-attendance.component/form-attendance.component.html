<div class="attendance-management-container">
    <!-- Loading State -->
    <div *ngIf="loading" class="loading-container">
        <div class="spinner"></div>
        <p>Loading attendance record...</p>
    </div>

    <!-- Main Content -->
    <div *ngIf="!loading && attendance" class="content-wrapper">
        <!-- Header -->
        <div class="page-header">
            <button class="btn-back" (click)="goBack()">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7" />
                </svg>
                Back
            </button>
            <h1>Edit Attendance Record</h1>
        </div>

        <!-- Alert Messages -->
        <div *ngIf="error" class="alert alert-error">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10" />
                <line x1="15" y1="9" x2="9" y2="15" />
                <line x1="9" y1="9" x2="15" y2="15" />
            </svg>
            {{ error }}
        </div>

        <div *ngIf="success" class="alert alert-success">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                <polyline points="22 4 12 14.01 9 11.01" />
            </svg>
            {{ success }}
        </div>

        <!-- Student Information Card -->
        <div class="info-card">
            <h2>Student Information</h2>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Name:</span>
                    <span class="info-value">{{ attendance.student.firstName }} {{ attendance.student.lastName }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Student ID:</span>
                    <span class="info-value">{{ attendance.student.studentId }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Date:</span>
                    <span class="info-value">{{ attendance.date | date: 'fullDate' }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Current Status:</span>
                    <span class="status-badge" [ngClass]="getStatusClass(attendance.status)">
                        {{ attendance.status | titlecase }}
                    </span>
                </div>
                <div class="info-item" *ngIf="attendance.isLate">
                    <span class="info-label">Late By:</span>
                    <span class="info-value late-indicator">{{ formatLateBy(attendance.lateBy) }}</span>
                </div>
                <div class="info-item" *ngIf="attendance.workHours">
                    <span class="info-label">Work Hours:</span>
                    <span class="info-value">{{ formatWorkHours(attendance.workHours) }}</span>
                </div>
                <div class="info-item" *ngIf="attendance.markedByTeacher">
                    <span class="info-label">Marked By:</span>
                    <span class="info-value">{{ attendance.markedByTeacher.name }}</span>
                </div>
            </div>
        </div>

        <!-- Edit Form -->
        <form class="edit-form" (ngSubmit)="updateAttendance()">
            <h2>Update Attendance</h2>

            <!-- Check-in Time -->
            <div class="form-group">
                <label for="checkInTime">
                    Check-in Time
                    <span class="label-hint">(Leave empty to keep current time)</span>
                </label>
                <input type="datetime-local" id="checkInTime" name="checkInTime" [(ngModel)]="checkInTime"
                    class="form-control" />
                <small class="form-help" *ngIf="attendance.checkInTime">
                    Current: {{ attendance.checkInTime | date: 'short' }}
                </small>
            </div>

            <!-- Check-out Time -->
            <div class="form-group">
                <label for="checkOutTime">
                    Check-out Time
                    <span class="label-hint">(Leave empty to keep current time)</span>
                </label>
                <input type="datetime-local" id="checkOutTime" name="checkOutTime" [(ngModel)]="checkOutTime"
                    class="form-control" />
                <small class="form-help" *ngIf="attendance.checkOutTime">
                    Current: {{ attendance.checkOutTime | date: 'short' }}
                </small>
            </div>

            <!-- Status -->
            <div class="form-group">
                <label for="status">
                    Status Override
                    <span class="label-hint">(Manual status - will override automatic calculation)</span>
                </label>
                <select id="status" name="status" [(ngModel)]="status" class="form-control">
                    <option value="">-- Select Status --</option>
                    <option *ngFor="let opt of statusOptions" [value]="opt.value">
                        {{ opt.label }}
                    </option>
                </select>
                <small class="form-help">
                    Leave empty to auto-calculate based on check-in/check-out times
                </small>
            </div>

            <!-- Note -->
            <div class="form-group">
                <label for="note">
                    Note
                    <span class="label-hint">(Optional)</span>
                </label>
                <textarea id="note" name="note" [(ngModel)]="note" rows="4" class="form-control"
                    placeholder="Add any relevant notes about this attendance record..."></textarea>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" (click)="resetForm()" [disabled]="saving">
                    Reset
                </button>
                <button type="submit" class="btn btn-primary" [disabled]="saving">
                    <span *ngIf="!saving">Update Attendance</span>
                    <span *ngIf="saving" class="btn-loading">
                        <span class="spinner-small"></span>
                        Updating...
                    </span>
                </button>
            </div>
        </form>

        <!-- Danger Zone -->
        <div class="danger-zone">
            <h2>Danger Zone</h2>
            <p>Delete this attendance record permanently. This action cannot be undone.</p>
            <button class="btn btn-danger" (click)="confirmDelete()" [disabled]="deleting">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6" />
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                </svg>
                Delete Attendance Record
            </button>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div *ngIf="showDeleteConfirm" class="modal-overlay" (click)="cancelDelete()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <div class="modal-header">
                <h3>Confirm Delete</h3>
                <button class="modal-close" (click)="cancelDelete()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="warning-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2">
                        <path
                            d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" />
                        <line x1="12" y1="9" x2="12" y2="13" />
                        <line x1="12" y1="17" x2="12.01" y2="17" />
                    </svg>
                </div>
                <p>Are you sure you want to delete this attendance record?</p>
                <p class="warning-text">
                    This will permanently delete the attendance record for
                    <strong>{{ attendance?.student.firstName }} {{ attendance?.student.lastName }}</strong>
                    on <strong>{{ attendance?.date | date: 'mediumDate' }}</strong>.
                </p>
                <p class="warning-text"><strong>This action cannot be undone.</strong></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" (click)="cancelDelete()" [disabled]="deleting">
                    Cancel
                </button>
                <button class="btn btn-danger" (click)="deleteAttendance()" [disabled]="deleting">
                    <span *ngIf="!deleting">Yes, Delete</span>
                    <span *ngIf="deleting" class="btn-loading">
                        <span class="spinner-small"></span>
                        Deleting...
                    </span>
                </button>
            </div>
        </div>
    </div>

    <!-- Error State -->
    <div *ngIf="!loading && !attendance" class="error-state">
        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10" />
            <line x1="15" y1="9" x2="9" y2="15" />
            <line x1="9" y1="9" x2="15" y2="15" />
        </svg>
        <h2>Attendance Record Not Found</h2>
        <p>The attendance record you're looking for doesn't exist or has been deleted.</p>
        <button class="btn btn-primary" (click)="goBack()">
            Go Back
        </button>
    </div>
</div>