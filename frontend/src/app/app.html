@defer(on timer(3000ms)){ @if (authService.isAuthenticated()) {

<div class="wrapper">
  <!-- Sidebar -->
  <aside class="sidebar" [class.collapsed]="sidebarCollapsed">
    <div class="sidebar-header">
      @if(!sidebarCollapsed){
      <div class="logo">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSx4ErfRJsxj2t0dJs1FwXBcKhp_F0VHDKUJQ&s" alt=""
          class="user-avatar-img rounded-0" />
        <span class="logo-text">Attendance</span>
      </div>
      }
      <button class="sidebar-toggle" (click)="toggleSidebar()">
        <i class="bi" [class.bi-layout-sidebar-inset]="!sidebarCollapsed"
          [class.bi-layout-sidebar-inset-reverse]="sidebarCollapsed"></i>
      </button>
    </div>

    <nav class="sidebar-nav">
      <ul class="nav-list">
        <li class="nav-item">
          <a class="nav-link" routerLink="/dashboard" routerLinkActive="active">
            <i class="bi bi-speedometer2"></i>
            <span class="nav-text">Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/students" routerLinkActive="active">
            <i class="bi bi-people"></i>
            <span class="nav-text">Students</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/teachers" routerLinkActive="active">
            <i class="bi bi-person-badge"></i>
            <span class="nav-text">Teachers</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/parents" routerLinkActive="active">
            <i class="bi bi-person-vcard"></i>
            <span class="nav-text">Parents</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/attendance" routerLinkActive="active">
            <i class="bi bi-calendar-check"></i>
            <span class="nav-text">Attendance</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/leave/request" routerLinkActive="active">
            <i class="bi bi-calendar-x"></i>
            <span class="nav-text">Leave Request</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" routerLink="/subjects" routerLinkActive="active">
            <i class="bi bi-book"></i>
            <span class="nav-text">Subjects</span>
          </a>
        </li>
      </ul>
    </nav>

    <div class="sidebar-footer">
      <div class="user-info">
        <div class="user-avatar">
          @if(currentUser?.role === 'Student') {
          <img src="{{studentData?.photo}}" alt="User" class="user-avatar-img" />
          }@else {
          <i class="bi bi-person-circle"></i>
          }
        </div>
        <div class="user-details">
          <span class="username">{{ currentUser?.username.toUpperCase() }}</span>
          <span class="user-role">{{currentUser?.role}}</span>
        </div>
      </div>
    </div>
  </aside>

  <!-- Main Content Area -->
  <div class="main-content">
    <!-- Top Navbar -->
    <header class="top-navbar">
      <div class="navbar-left">
        <button class="mobile-toggle" (click)="toggleSidebar()">
          <i class="bi bi-list"></i>
        </button>
        <h1 class="page-title">School Management System</h1>
      </div>

      <div class="navbar-right">
        @if(currentUser?.role !== 'Student') {
        <button class="nav-icon-btn animate__animated" title="Notifications" data-bs-toggle="offcanvas"
          [class]="count.isclass ? 'animate__bounce' : 'animate__bounce'" data-bs-target="#offcanvasWithBothOptions"
          aria-controls="offcanvasWithBothOptions">
          <i [class]="count.isTrue ? 'bi bi-bell' : 'bi bi-bell-fill'"></i>
          <span class="badge">{{count.count}}</span>
        </button>
        <button class="nav-icon-btn" title="Messages" id="closeBtn">
          <i class="bi bi-grid me-2"></i>
        </button>
        }
        <div class="user-menu">
          <button class="user-menu-btn" (click)="toggleUserMenu()">
            @if(currentUser.role === "Student"){
            <img src="{{studentData?.photo}}" alt="User" class="user-avatar-img" />
            }@else {
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTUlOnqog4d0763K2WzYq1ugV5OFhgq69ilnw&s"
              alt="User" class="user-avatar-img" />
            }
            <span class="user-name">{{ currentUser?.username }}</span>
            <i class="bi bi-chevron-down"></i>
          </button>

          @if (userMenuOpen) {
          <div class="user-dropdown">
            <a class="dropdown-item" href="#">
              <i class="bi bi-gear"></i>
              <span>Settings</span>
            </a>
            <hr class="dropdown-divider" />
            <a class="dropdown-item text-danger" (click)="logout()">
              <i class="bi bi-box-arrow-right"></i>
              <span>Logout</span>
            </a>
          </div>
          }
        </div>
      </div>
    </header>

    <!-- Page Content -->
    <main class="page-content">
      <router-outlet />
    </main>
  </div>
</div>
<div class="offcanvas offcanvas-start" data-bs-scroll="true" tabindex="-1" id="offcanvasWithBothOptions"
  aria-labelledby="offcanvasWithBothOptionsLabel" style="width: 450px;">
  @if(count.count > 0){
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="offcanvasScrollingLabel"><button type="button"
        class="btn btn-primary position-relative">
        Notifications
        <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
          {{count.count}}
          <span class="visually-hidden">unread messages</span>
        </span>
      </button></h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Student</th>
          <th>Reason</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        @for (item of leaveRequests; track $index) {
        <tr>
          @if (item.status === 'pending') {
          <td>{{ item.student.firstName }} {{ item.student.lastName }}</td>
          <td>{{ item.reason }}</td>
          <td>
            <span class="badge bg-warning text-dark">Pending</span>
          </td>
          <td>
            <button routerLink="/leave/review" class="btn btn-outline-primary" title="View Details"
              data-bs-dismiss="modal">
              <i class="bi bi-eye"></i>
            </button>
          </td>
          }
        </tr>
        }
      </tbody>
    </table>
  </div>
  }@else {
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="offcanvasScrollingLabel">Notifications</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
    <p>No pending leave requests.</p>
  </div>
  }
</div>

} @else {
<router-outlet />
} }@placeholder {
<!-- From Uiverse.io by PriyanshuGupta28 -->
<div class="wrapper-spnner">
  <!-- From Uiverse.io by thekuntal49 -->
  <div class="loader">
    <div class="progress" data-percentage="100%"></div>
  </div>
</div>
}